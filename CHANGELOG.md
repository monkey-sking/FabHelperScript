# Fab Helper 更新日志

## v3.4.0 (2025-12-13)

### 🐛 关键 Bug 修复

#### 1. 修复付费商品被错误添加到待办队列的问题
- **问题**: 脚本之前会将所有未拥有的商品（包括付费商品）添加到待办队列并尝试执行
- **原因**: 扫描页面时只检查了商品是否已拥有，没有检查是否免费
- **修复**: 
  - 新增 `isFreeCard()` 辅助函数，通过检测卡片文本判断是否为免费商品
  - 在3个添加商品的位置（两个 `toggleExecution` 函数和自动添加功能）都添加了免费检查
  - 检测逻辑：包含"免费"/"Free"关键词 且 不包含非零价格（如 $1.99）

#### 2. 修复许可证选择时点击付费选项的问题
- **问题**: 在详情页选择许可证时，脚本会错误点击"个人"选项，即使它是付费的（$1.99）
- **原因**: 选择逻辑只检查是否包含"个人"/"Personal"文本，没有验证价格
- **修复**: 
  - 增加价格验证，只有当选项同时包含免费关键词且没有非零价格时才点击
  - 支持检测 `-100%` 折扣（限时免费）情况

### 🌐 国际化 (i18n)

- 修复 `log_entering_rate_limit_from` 中文翻译缺失
- 新增 `log_recon_end` 翻译键（中文："扫描已完成。"）
- 修复 `checkAuthentication` 函数中错误的 UI 引用和翻译键

### 🔧 代码改进

- 修复 `State.UI.startStopButton` 引用错误（应为 `State.UI.execBtn`）
- 统一使用 `isFreeCard()` 函数替代不可靠的 CSS selector 检查

---

## v3.3.0 (2025-08-31)

- 初始优化版本
- 减少 API 请求
- 提高性能
- 增强稳定性
- 修复限速刷新问题
