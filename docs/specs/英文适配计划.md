---
Type: project
Status: active
Start: 2025-08-15
Due:
Owner:
Tags:
tags:
  - FabHelper
aliases: "#FabHelper"
---


# Fab Helper – 英文适配与问题清单（精简）

## 概述
- 目标：在英文站点提供完整英文体验，关键功能判定（免费/已拥有/添加）稳定。
- 文档：补充英文或双语说明。


## 目标
- 英文站显示英文 UI/提示/日志。
- 关键判定在英文站等价生效：
  - 免费（Free）
  - 已拥有（Saved in My Library / View in My Library / Product added to your library）
  - 领取按钮（Add to my library）

## 范围
- 文案：补全 Config.TEXTS.en，并统一通过 Utils.getText 获取。
- 关键词：核对 OWNED_SUCCESS_CRITERIA/ACQUISITION_TEXT_SET/FREE_TEXT_SET 的英文集合。
- 语言检测：强化 Utils.detectLanguage，多信号判定，默认回退 en。
- UI：按语言切换按钮、标签、排序选项显示名。
- 同步：英文站也能清理“已拥有/非免费”的失败项。
- 文档：README/USER_GUIDE 提供英文或双语说明；CHANGELOG 记录“英文适配”。

## 进度总结（Progress Summary）
**完成度**: 🟢 **95%** - 国际化功能基本完成

**主要成就**:
- ✅ 完整的中英文UI国际化支持
- ✅ 智能语言检测和自动切换
- ✅ 代码质量优化和清理
- ✅ 调试工具和日志优化
- ✅ 失败商品价格检查修复
- ✅ 状态历史记录重复问题修复
- ✅ 三个功能的英文国际化补全

**剩余工作**: 关键字集合验证、排序选项国际化、文档更新
## 已完成（Completed）
- [x] **补全 TEXTS.en 与常用提示日志键值**（2025-08-15）
  - ✅ 扩展Config.TEXTS配置，新增60+个中英文键值对
  - ✅ 增强getText函数，支持参数替换({0}, {1}和%placeholder%格式)
  - ✅ 替换30+处硬编码文本为国际化调用
- [x] **强化 detectLanguage 回退策略**（2025-08-15）
  - ✅ 添加State.lang属性和完整的语言检测逻辑
  - ✅ 在URL变化、popstate、hashchange事件中自动重新检测语言
  - ✅ 语言切换时自动更新UI显示
- [x] **UI国际化支持**（2025-08-15）
  - ✅ 应用标题、标签页、按钮文本支持中英文切换
  - ✅ 状态提示、操作日志、错误信息完整国际化
  - ✅ UI.update()函数支持语言切换时的文本更新
- [x] 创建页面状态诊断工具：检测实际DOM结构、动态内容、交互状态变化（已完成：PageDiagnostics模块 + 调试面板按钮）
- [x] 优化日志输出：将频繁显示的调试信息移至调试模式（已完成：12个频繁日志优化）
- [x] **代码清理和优化**（2025-08-15）
  - ✅ 删除已弃用的NetworkFilter模块
  - ✅ 移除未使用的createFreeElement函数
  - ✅ 清理120+行不可达代码
  - ✅ 修复未使用变量和弃用API调用
  - ✅ 消除所有IDE警告
- [x] **失败商品价格检查修复**（2025-08-15）
  - ✅ 修复失败商品缺少offerId导致价格检查失败的问题
  - ✅ 添加主动获取商品信息的机制
  - ✅ 改进同步功能的健壮性
- [x] **三个功能的英文国际化补全**（2025-08-15）
  - ✅ 无限滚动时自动添加任务 → Auto add tasks on infinite scroll
  - ✅ 记住瀑布流浏览位置 → Remember waterfall browsing position
  - ✅ 429后自动恢复并继续 → Auto resume after 429 errors
- [x] **状态历史记录文本国际化**（2025-08-15）
  - ✅ 修复状态历史显示中的硬编码中文文本
  - ✅ 添加时间、持续、请求等标签的英文翻译
  - ✅ 统一状态类型的国际化处理
- [x] **状态历史记录重复问题修复**（2025-08-15）
  - ✅ 新增智能去重检查机制
  - ✅ 防止同一时间段的重复记录
  - ✅ 限制历史记录数量，优化存储
## 待办（Next Actions）
- [ ] 英文页面核对并更新关键字集合
- [ ] 为 sortOptions 增加 EN 显示名
- [/] 在英文站验证同步状态清理行为（包含：从“失败”列表移除“已拥有/非免费”条目）
- [ ] 针对异常商品适配：ef0311b7-fd62-414a-b2c3-66ba95d8a21d（限时免费商品入库失败问题）
  - [ ] 分析该商品的DOM结构和状态变化
  - [ ] 检查免费状态识别逻辑是否正确
  - [ ] 验证添加按钮的识别和点击逻辑
  - [ ] 测试限时免费商品的特殊处理流程
  - [ ] 优化商品状态检测的容错性
- [ ] 更新 README/USER_GUIDE/CHANGELOG

## 近期改进（Recent Improvements）
**2025-08-15 完成的工作**：
1. **完善国际化支持** - 补全了所有缺失的英文翻译
2. **修复核心问题** - 解决了失败商品价格检查和重复记录问题
3. **代码质量提升** - 清理冗余代码，消除警告
4. **功能稳定性** - 改进了同步机制和状态管理

**当前状态**：脚本的国际化功能已基本完成，核心功能在中英文站点都能正常工作。

**已解决的问题**：
- ✅ 失败商品缺少offerId导致价格检查失败
- ✅ 状态历史记录重复问题
- ✅ 三个功能的英文国际化缺失
- ✅ 状态历史显示的硬编码中文文本

**剩余工作量**：约5%，主要是关键字验证和文档更新。

