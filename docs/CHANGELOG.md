# 更新日志

## 3.5.1 (2025-12-28)

### 功能修复

- 修复 **待办数量翻倍** 问题：
  - 在 `scanAndAddTasks` 中添加严格的 uid/url 去重检查
  - 添加 `isScanningTasks` 扫描锁，防止并发调用导致重复添加
- 修复 **入库操作立即关闭** 问题：
  - 增强工作标签页页面就绪检测机制（最长 15 秒等待）
  - 使用多重检测（DOM 元素、readyState、交互内容）确保页面完全加载后再执行
- 修复 **按钮检测失败** 问题：
  - 使用大小写不敏感匹配，兼容 "Add to My Library" 等变体
  - 添加备用方案：检测包含 "add" + "library" 或 "添加" + "库" 的按钮
  - 记录所有可见按钮文本用于调试
- 增强 **失败任务日志记录**：`markAsFailed` 方法现在支持记录详细的失败信息，包括：
  - 失败原因和时间戳
  - 错误详情（执行时间、workerId、instanceId）
  - 工作线程日志（最后 5 条）
  - 重试次数

### 代码优化

- Watchdog 超时处理现在使用增强的 `markAsFailed` 记录超时详情
- 添加去重日志输出，便于调试重复添加问题

## 3.5.0 (2025-12-27)

### 重构

- **模块化架构**：将单文件脚本重构为 15+ 个功能模块，提高代码可维护性
- **构建系统**：引入 `esbuild` 进行代码打包和优化
- **项目整理**：归档旧版本文件，清理项目结构

### 国际化

- **英文文档**：新增 `README_EN.md`，支持多语言文档索引

### 功能修复

- 修复 **UI 不显示** 的问题 (`State.UI` 对象缺失)
- 修复 **计数异常** 问题 (`Database` 模块计数逻辑优化)
- 修复 **Launcher 无限循环** 问题 (增加错误处理)

## 3.2.2 (2025-07-23)

### 功能优化

- 改进自动刷新判断逻辑，使用UI上显示的可见商品数量作为依据，更准确地反映实际情况
- 优化页面刷新方式，确保刷新后UI能正确重新加载
- 添加UI自动恢复机制，解决长时间无操作后UI消失的问题
- 修改脚本加载时机为document-idle，确保页面完全加载后再执行

### 功能修复

- 修复限速状态下隐藏所有商品后可能不刷新的问题
- 修复刷新后脚本UI可能不显示的问题
- 修复标签页切换后UI可能丢失的问题

## 3.2.1 (2025-07-23)

### 代码优化

- 精简调试相关代码，减少不必要的日志输出
- 优化缓存清理逻辑，提高代码复用性
- 改进错误处理和日志格式，更易于阅读
- 移除未使用的过时函数
- 简化网络请求监控逻辑
- 修正控制台输出格式，减少调试信息

### 功能修复

- 修复限速状态下隐藏所有商品后不自动刷新的问题
- 改进限速状态检测逻辑，在无可见商品时主动刷新
- 优化隐藏/显示功能，更准确地计算可见商品数量
- 减少限速状态下的自动刷新等待时间

## 3.2.0 (2023-07-23)

### 优化更新

- 新增数据缓存系统，减少重复API请求
- 添加请求拦截器，自动缓存网页发送的API响应
- 优化商品拥有状态检查，减少API请求次数
- 优化价格验证功能，利用缓存减少API请求
- 改进限速状态检测，使用Performance API提前发现问题
- 优化倒计时刷新功能，更智能地检测限速状态恢复
- 修复API返回数据格式不一致的问题
- 增强对网页排序选项的适配能力

## 3.1.0 (2023-07-22)

### 新功能

- 添加聊天记录导出功能
- 实现脚本热更新功能
- 增加用户界面配置选项

### 改进

- 优化限速检测算法，减少误判
- 改进游标恢复精确度
- 提高 DOM 观察器效率

### 修复

- 修复多个游标格式识别问题
- 解决部分页面上 UI 元素未正确显示的问题
- 修复连续触发限速恢复的逻辑错误

## [1.0.0] - 2023-XX-XX

### 首次发布

- 实现限速检测和自动恢复
- 请求去抖动和节流功能
- 游标位置保存和恢复
- DOM 观察和增强
- 基础日志记录系统

## 版本号规范

Fab Helper 脚本遵循 [语义化版本控制](https://semver.org/lang/zh-CN/) 规范：

- **主版本号**：当进行不兼容的 API 更改时增加
- **次版本号**：当添加向后兼容的新功能时增加
- **修订号**：当进行向后兼容的问题修复时增加

额外的标签：

- **alpha**：早期测试版本，功能不完整
- **beta**：功能完整但可能不稳定
- **rc**：候选发布版本，即将正式发布

例如：

- 1.0.0-alpha.1
- 1.0.0-beta.2
- 1.0.0-rc.1
- 1.0.0
